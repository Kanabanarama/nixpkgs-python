# -*- mode: sh -*-

cachix use pypi2nix
cachix use nixpkgs-python
sudo mount -o remount,exec,size=4G,mode=755 /run/user || true
if [ $TRAVIS_PULL_REQUEST = "false" -a \
     $TRAVIS_BRANCH = "master" -a \
     $TRAVIS_REPO_SLUG = "garbas/nixpkgs-python" \
   ]; then
    openssl aes-256-cbc -K $encrypted_1ae048d151c2_key -iv $encrypted_1ae048d151c2_iv -in deploy_rsa.enc -out deploy_rsa -d
    eval "$(ssh-agent -s)"
    chmod 600 $TRAVIS_BUILD_DIR/deploy_rsa
    ssh-add $TRAVIS_BUILD_DIR/deploy_rsa
fi
nix-env -iA nixpkgs.nix-prefetch-git nixpkgs.nix-prefetch-hg nixpkgs.cachix
echo 'garbas.si ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIPNIqf3Qgnwr/CMslsEK7qIFHOcWWdxvzJIZwBQPjulZ' >> $HOME/.ssh/known_hosts
